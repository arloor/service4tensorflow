<!DOCTYPE html>
<html lang="en" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link href="style.css" rel="stylesheet" type="text/css">

    <!-- 开发环境版本，包含了有帮助的命令行警告 -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>
<body>
<!--<div id="app">-->
<!--{{ message }}-->
<!--</div>-->

<!--<div id="app-2">-->
<!--<span v-bind:title="message">-->
<!--鼠标悬停几秒钟查看此处动态绑定的提示信息！-->
<!--</span>-->
<!--</div>-->


<div id="header">
    <div class="model_info" style="display: inline">
        <label>模型地址</label>
        <input type="text" placeholder="请输入模型的地址" value="">
    </div>
</div>

<div id="button_area">
    <div class="input">
        <button>更新所有模型</button>
        <button onclick="for_all_status()">刷新所有节点</button>
        <button onclick="get_all_status()">显示最新状态</button>
    </div>
</div>

<div class="panel_area" id="panel_area">

    <div class="panel" v-for="node in nodes">
        <table width="900px">
            <tr>
                <td width="200px">节点名</td>
                <td width="700px">
                    <div style="width: 500px;word-wrap:break-word">{{ node.nodeName }}</div>
                </td>
            </tr>
            <tr>
                <td width="200px">model地址</td>
                <td class="url" width="700px">
                    <div style="width: 700px;word-wrap:break-word">{{ node.modelURL }}</div>
                </td>
            </tr>
            <tr>
                <td width="200px">最后更新时间</td>
                <td width="700px">{{ node.updateTime }}</td>
            </tr>
            <tr>
                <td width="200px">最后通信时间</td>
                <td width="700px">{{ node.lastMsgTime }}</td>
            </tr>
            <tr v-if="node.expired">
                <td width="200px" style="color: #9900CC">过期请刷新</td>
                <td width="700px">
                    <div class="td_button_block">
                        <button v-on:click="for_single_status(node.nodeName)">刷新节点状态</button>
                        <button onclick="get_all_status()">显示最新状态</button>
                        <button v-on:click="delete_single_status(node.nodeName)">确认宕机 删除监测信息</button>
                    </div>
                </td>
            </tr>
        </table>
        <div class="panel_input">
            <button>更新节点模型</button>
        </div>
    </div>


</div>

</body>

<script>


    var panel_area = new Vue({
        el: '#panel_area',
        data: {
            nodes: []
        },
        methods: {
            for_single_status: function (nodeName) {
                var xmlhttp= new XMLHttpRequest();;
                xmlhttp.onreadystatechange = function () {
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                        alert(xmlhttp.responseText);
                    }
                }
                xmlhttp.open("GET", "http://localhost:9000/for_single_status?nodeName="+nodeName, true);
                xmlhttp.setRequestHeader("Content-type", "application/json");
                xmlhttp.send();
            },
            delete_single_status:function (nodeName) {
                var xmlhttp= new XMLHttpRequest();;
                xmlhttp.onreadystatechange = function () {
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                        var result = eval('(' + xmlhttp.responseText + ')');
                        panel_area.nodes = result;
                        alert("删除监测信息成功")
                    }
                }
                xmlhttp.open("GET", "http://localhost:9000/delete_single_status?nodeName="+nodeName, true);
                xmlhttp.setRequestHeader("Content-type", "application/json");
                xmlhttp.send();
            }
        }
    })

    function for_all_status() {
        var xmlhttp= new XMLHttpRequest();;
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                alert(xmlhttp.responseText);
            }
        }
        xmlhttp.open("GET", "http://localhost:9000/for_all_status", true);
        xmlhttp.setRequestHeader("Content-type", "application/json");
        xmlhttp.send();
    }

    function get_all_status() {
        var xmlhttp= new XMLHttpRequest();
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var result = eval('(' + xmlhttp.responseText + ')');
                panel_area.nodes = result;

            }
        }
        xmlhttp.open("GET", "http://localhost:9000/get_all_status", true);
        xmlhttp.setRequestHeader("Content-type", "application/json");
        xmlhttp.send();
    }

    window.onload = function (ev) {
        get_all_status()
    }
</script>
</html>